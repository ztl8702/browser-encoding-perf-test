!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/libs/",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"start",value:function(){throw new Error("Not implemented")}},{key:"stop",value:function(){throw new Error("Not implemented")}},{key:"download",value:function(){throw new Error("Not implemented")}}]),e}();function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"recording.ogg",n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=e,n.download=t,n.click()}function a(){return(window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()).toString()}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];return n=o=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o._mediaRecorder=null,c(o,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),u(t,[{key:"_ensureInitialized",value:function(){var e=this;return null===this._mediaRecorder?new Promise(function(t,n){navigator.getUserMedia({audioBitsPerSecond:44100,audio:!0,mimeType:"application/ogg"},function(n){e._mediaRecorder=new MediaRecorder(n),e._mediaRecorder.ondataavailable=function(t){return e._saveMediaData(t.data)},t()},function(e){console.log("The following gUM error occurred: "+e),n()})}):new Promise(function(e){e()})}},{key:"start",value:function(){var e=this;this._ensureInitialized().then(function(){return e._mediaRecorder.start()})}},{key:"stop",value:function(){var e=this;return new Promise(function(t){e._mediaRecorder.onstop=function(){return t()},e._mediaRecorder.stop()})}},{key:"download",value:function(){if(null!==this._recordedData){var e=window.URL.createObjectURL(this._recordedData);console.log("Audio URL:",e),i(e,"recording"+a()+".ogg")}}},{key:"_saveMediaData",value:function(e){this._recordedData=e}}]),t}(),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),d=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._encoder=null,e._audioContext=null,e._audioProcessingNode=null,e._audioSource=null,e._stopPromiseResolver=null,e._encoder=new Worker("/build/flacEncodeWorker.min.js"),e._encoder.onmessage=function(t){"end"===t.data.command?(e._data=t.data.buf,null!==e._stopPromiseResolver&&(e._stopPromiseResolver(),e._stopPromiseResolver=null)):"debug"===t.data.cmd?console.log(t.data):console.error('Unknown event\n                    from encoder (WebWorker): "'+t.data.command+'"!')},navigator.getUserMedia({audioBitsPerSecond:44100,audio:!0,mimeType:"application/ogg"},function(t){e._audioContext=new AudioContext,e._audioSource=e._audioContext.createMediaStreamSource(t),e._audioProcessingNode=e._audioContext.createScriptProcessor(4096,1,1),e._audioProcessingNode.onaudioprocess=function(t){var n=t.inputBuffer.getChannelData(0);e._encoder.postMessage({command:"encode",buf:n})}},function(e){console.log("The following gUM error occurred: "+e)}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),l(t,[{key:"start",value:function(){this._encoder.postMessage({command:"init",config:{sampleRate:44100,bps:16}}),this._audioSource.connect(this._audioProcessingNode),this._audioProcessingNode.connect(this._audioContext.destination)}},{key:"stop",value:function(){var e=this;return new Promise(function(t){e._audioProcessingNode.disconnect(),e._audioSource.disconnect(),e._stopPromiseResolver=t,e._encoder.postMessage({command:"finish"})})}},{key:"download",value:function(){if(null!==this._data){var e=window.URL.createObjectURL(this._data);console.log("Audio URL:",e),i(e,"recording"+a()+".flac")}}}]),t}(),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),p=16,h=44100,_=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._audioContext=null,e._audioProcessingNode=null,e._audioSource=null,e._wavLength=0,e._wavBuffers=[],navigator.getUserMedia({audioBitsPerSecond:h*p,audio:!0,mimeType:"application/ogg"},function(t){e._audioContext=new AudioContext,e._audioSource=e._audioContext.createMediaStreamSource(t),e._audioProcessingNode=e._audioContext.createScriptProcessor(4096,1,1),e._audioProcessingNode.onaudioprocess=function(t){var n=t.inputBuffer.getChannelData(0);e._saveWavPCM(n)}},function(e){console.log("The following gUM error occurred: "+e)}),e._saveWavPCM=e._saveWavPCM.bind(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),f(t,[{key:"start",value:function(){this._wavBuffers=[],this._wavLength=0,this._wavBuffers.push(this._createWavHeader()),this._audioSource.connect(this._audioProcessingNode),this._audioProcessingNode.connect(this._audioContext.destination)}},{key:"stop",value:function(){return this._audioProcessingNode.disconnect(),this._audioSource.disconnect(),this._data=this._exportMonoWAV(this._wavBuffers,this._wavLength),Promise.resolve()}},{key:"download",value:function(){if(null!==this._data){var e=window.URL.createObjectURL(this._data);console.log("Audio URL:",e),i(e,"recording"+a()+".wav")}}},{key:"_createWavHeader",value:function(){var e=new ArrayBuffer(44),t=new DataView(e);return g(t,0,"RIFF"),g(t,8,"WAVE"),g(t,12,"fmt "),t.setUint32(16,16,!0),t.setUint16(20,1,!0),t.setUint16(22,1,!0),t.setUint32(24,h,!0),t.setUint32(28,1*Number(h)*p/8,!0),t.setUint16(32,1*Number(p)/8,!0),t.setUint16(34,p,!0),g(t,36,"data"),t.setUint32(4,10,!0),t.setUint32(40,10,!0),new Uint8Array(e)}},{key:"_saveWavPCM",value:function(e){this._wavBuffers.push(new Float32Array(e)),this._wavLength+=e.length}},{key:"_exportMonoWAV",value:function(e,t){for(var n=2*t,o=new ArrayBuffer(44+n),r=new DataView(o),i=e[0],a=i.length,u=0;u<a;++u)r.setUint8(u,i[u]);return r.setUint32(4,32+n,!0),r.setUint32(40,n,!0),function(e,t,n){for(var o=void 0,r=n.length,i=void 0,a=void 0,u=void 0,c=1;c<r;++c)for(i=(o=n[c]).length,a=0;a<i;++a,t+=2)u=Math.max(-1,Math.min(1,o[a])),e.setInt16(t,u<0?32768*u:32767*u,!0)}(r,44,e),new Blob([r],{type:"audio/wav"})}}]),t}();function g(e,t,n){for(var o=n.length,r=0;r<o;++r)e.setUint8(t+r,n.charCodeAt(r))}var v=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.RECORDING_FORMAT;switch(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.RECORDING_FORMAT="wav",this._delegate=null,console.log("RecordingController: format=",this.RECORDING_FORMAT),t){case"ogg":this._delegate=new s;break;case"flac":this._delegate=new d;break;case"wav":this._delegate=new _;break;default:throw new Error("Unknown codec: "+this.RECORDING_FORMAT)}}return v(e,[{key:"startRecording",value:function(){this._delegate.start()}},{key:"stopRecording",value:function(){return this._delegate.stop()}},{key:"downloadRecordedData",value:function(){this._delegate.download()}}]),e}();n.d(t,"RecordingController",function(){return w}),window.runTest=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"wav",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n=new w(e);console.log("Test format",e),setTimeout(function(){console.log("Test starts"),n.startRecording(),setTimeout(function(){n.stopRecording().then(function(){console.log("Recording stopped."),n.downloadRecordedData(),console.log("Download triggered")})},1e3*t)},1e3)}}]);
//# sourceMappingURL=bundle.min.map