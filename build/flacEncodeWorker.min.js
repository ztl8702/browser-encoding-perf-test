!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/libs/",n(n.s=1)}([,function(e,t){var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();importScripts("/build/libflac3-1.3.2.min.js");var r={0:"FLAC__STREAM_ENCODER_OK",1:"FLAC__STREAM_ENCODER_UNINITIALIZED",2:"FLAC__STREAM_ENCODER_OGG_ERROR",3:"FLAC__STREAM_ENCODER_VERIFY_DECODER_ERROR",4:"FLAC__STREAM_ENCODER_VERIFY_MISMATCH_IN_AUDIO_DATA",5:"FLAC__STREAM_ENCODER_CLIENT_ERROR",6:"FLAC__STREAM_ENCODER_IO_ERROR",7:"FLAC__STREAM_ENCODER_FRAMING_ERROR",8:"FLAC__STREAM_ENCODER_MEMORY_ALLOCATION_ERROR"},i=Object.freeze({UNINTIALISED:Symbol("uninitialised"),WORKING:Symbol("working"),FINISHED:Symbol("finished")}),a=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4096;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._encoderId=0,this._flacBuffers=[],this._flacLength=0,this._state=i.UNINTIALISED,this._data=null,this._onMetadataAvailable=function(){},!Flac.isReady())throw new Error("libflac is not ready yet!");if(this._sampleRate=t,this._bitDepth=n,this._bufferSize=r,this._encoderId=Flac.init_libflac_encoder(this._sampleRate,1,this._bitDepth,5,0,!0,0),0===this._encoderId)throw new Error("Failed to create libflac encoder.");if(0!==Flac.init_encoder_stream(this._encoderId,this._onEncodedData.bind(this),this._onMetadataAvailable.bind(this)))throw new Error("Failed to initalise libflac encoder.");this._state=i.WORKING}return n(e,[{key:"encode",value:function(e){if(this._state!==i.WORKING)throw new Error("Encoder is not ready or has finished.");if(!Flac.isReady())throw new Error("Flac not ready");for(var t=e.length,n=new Int32Array(t),a=new DataView(n.buffer),o=0,l=0;l<t;l++)a.setInt32(o,32767*e[l],!0),o+=4;if(!0!==Flac.FLAC__stream_encoder_process_interleaved(this._encoderId,n,n.length)){var c=Flac.FLAC__stream_encoder_get_state(this._encoderId);console.error("Error during encoding",r[c])}}},{key:"finish",value:function(){if(this._state===i.WORKING){this._state=i.FINISHED;var e=Flac.FLAC__stream_encoder_finish(this._encoderId);console.log("flac finish: ",e),Flac.FLAC__stream_encoder_delete(this._encoderId),this._data=this._exportFlacBlob()}}},{key:"getStats",value:function(){return{samplesEncoded:this._bufferSize}}},{key:"getBlob",value:function(){return this._state===i.FINISHED?this._data:null}},{key:"_exportFlacBlob",value:function(){var e=function(e,t){for(var n=new Uint8Array(t),r=0,i=e.length,a=0;a<i;a++){var o=e[a];n.set(o,r),r+=o.length}return n}(this._flacBuffers,this._flacLength);return new Blob([e],{type:"audio/flac"})}},{key:"_onEncodedData",value:function(e,t){this._flacBuffers.push(e),this._flacLength+=e.byteLength}}]),e}(),o=null;self.onmessage=function(e){switch(e.data.command){case"init":var t=e.data.config.bps,n=e.data.config.sampleRate;Flac.isReady()?o=new a(n,t):Flac.onready=function(){setTimeout(function(){o=new a(n,t)},0)};break;case"encode":null===o?console.error("flacEncoderWorker:received data when the encoder is not ready."):o.encode(e.data.buf);break;case"finish":if(null!==o){o.finish();var r=o.getBlob();self.postMessage({command:"end",buf:r}),o=null}}}}]);
//# sourceMappingURL=flacEncodeWorker.min.map